!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).OptimizelyTracker={})}(this,function(t){"use strict";var i=function(t,n){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},i(t,n)},n=function(){return n=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var r in i=arguments[n])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);return t},n.apply(this,arguments)};function e(t,i,n,e){return new(n||(n=Promise))(function(r,s){function o(t){try{c(e.next(t))}catch(t){s(t)}}function u(t){try{c(e.throw(t))}catch(t){s(t)}}function c(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(o,u)}c((e=e.apply(t,i||[])).next())})}function r(t,i){var n,e,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,e&&(r=2&u[0]?e.return:u[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,u[1])).done)return r;switch(e=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(6===u[0]&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=i.call(t,s)}catch(t){u=[6,t],e=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function s(t,i,n){if(n||2===arguments.length)for(var e,r=0,s=i.length;r<s;r++)!e&&r in i||(e||(e=Array.prototype.slice.call(i,0,r)),e[r]=i[r]);return t.concat(e||Array.prototype.slice.call(i))}function o(){return"v_"+c(16)}function u(){return"s_"+c(12)+"_"+Date.now()}function c(t){for(var i="",n=0;n<t;n++)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return i}function a(){return Date.now()}function h(t,i){var n;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n||(t.apply(void 0,e),n=!0,setTimeout(function(){return n=!1},i))}}function f(){return"undefined"!=typeof window&&"undefined"!=typeof document}function l(t,i){try{return JSON.parse(t)}catch(t){return i}}function d(t){try{return JSON.stringify(t)}catch(t){return"{}"}}function v(){return f()?window.location.href.split("#")[0].split("?")[0]:""}function m(){return f()&&document.title||""}function p(){return f()&&document.referrer||""}function w(){return f()&&navigator.userAgent||""}function g(){if(!f())return"server";var t=w().toLowerCase();return/android/.test(t)?"android":/iphone|ipad|ipod/.test(t)?"ios":/windows/.test(t)?"windows":/mac/.test(t)?"mac":/linux/.test(t)?"linux":"unknown"}function y(){if(!f())return"unknown";var t=w().toLowerCase();return/chrome/.test(t)&&!/edge/.test(t)?"chrome":/firefox/.test(t)?"firefox":/safari/.test(t)&&!/chrome/.test(t)?"safari":/edge/.test(t)?"edge":/opera/.test(t)?"opera":"unknown"}function b(t){f()&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}function k(t,i){var e=n({},t);for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],o=e[r];T(s)&&T(o)?e[r]=k(o,s):void 0!==s&&(e[r]=s)}return e}function T(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)}"function"==typeof SuppressedError&&SuppressedError;var I=function(){function t(t){void 0===t&&(t={}),this.name="behavioral",this.t=null,this.i=!1,this.o=0,this.u=0,this.h=0,this.l=0,this.v=0,this.m=0,this.p=0,this.k=0,this.T=new Set,this.I=new Map,this.S=[],this.M=0,this._=n({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!0,enableVisibilityTracking:!0,enablePerformanceTracking:!0,scrollThreshold:25,mouseSampleRate:100,clickSelector:'a, button, [role="button"], input[type="submit"], input[type="button"]',formSelector:"form, input, textarea, select",excludeSelectors:[".tracking-ignore",'[data-tracking="false"]'],maxScrollEvents:100,maxMouseEvents:500},t)}return t.prototype.init=function(){var t;f()&&(this.i=!0,this.o=a(),this.u=a(),this.O(),this.A(),null===(t=this.t)||void 0===t||t.config.debug)},t.prototype.setTracker=function(t){this.t=t},t.prototype.O=function(){this._.enableClickTracking&&this.V(),this._.enableScrollTracking&&this.j(),this._.enableFormTracking&&this.P(),this._.enableMouseTracking&&this.C(),this._.enableVisibilityTracking&&this.D(),this._.enablePerformanceTracking&&this.N(),this.J()},t.prototype.V=function(){var t=this,i=function(i){if(t.i&&t.t){var n=i.target;if(n&&!t.F(n)){if(!n.matches(t._.clickSelector)){for(var e=n.parentElement,r=!1,s=0;s<3&&e;s++){if(e.matches(t._.clickSelector)){r=!0;break}e=e.parentElement}if(!r)return}var o={element:t.R(n),tagName:n.tagName.toLowerCase(),className:n.className,id:n.id||"",text:t.U(n),x:i.clientX,y:i.clientY,timestamp:a()};t.G("click",o),t.m++,t.H(),t.t.config.debug}}};document.addEventListener("click",i,{passive:!0}),this.S.push(function(){return document.removeEventListener("click",i)})},t.prototype.j=function(){var t=this,i=0,n=h(function(){if(t.i&&t.t&&!(t.h>=t._.maxScrollEvents)){var n=window.pageYOffset||document.documentElement.scrollTop,e=document.documentElement.scrollHeight-window.innerHeight,r=Math.round(n/e*100);if(t.v=Math.max(t.v,r),Math.abs(r-Math.round(i/e*100))<t._.scrollThreshold)i=n;else{var s=a(),o=n>i?"down":"up",u=Math.abs(n-i)/(s-t.M),c={depth:r,maxDepth:t.v,direction:o,speed:u,timestamp:s};t.G("scroll",c),t.h++,t.H(),i=n,t.M=s,t.t.config.debug}}},250);window.addEventListener("scroll",n,{passive:!0}),this.S.push(function(){return window.removeEventListener("scroll",n)})},t.prototype.P=function(){var t=this,i=function(i,n){var e;if(t.i&&t.t){var r=i.target;if(r&&!t.F(r)){var s=r.closest("form"),o={formId:(null==s?void 0:s.id)||"",formName:(null==s?void 0:s.getAttribute("name"))||"",field:t.R(r),fieldType:r.type||r.tagName.toLowerCase(),action:n,value:"change"===n?null===(e=r.value)||void 0===e?void 0:e.slice(0,50):void 0,timestamp:a()};t.G("form_interaction",o),t.p++,t.H(),t.t.config.debug}}};["focus","blur","change"].forEach(function(n){var e=function(t){return i(t,n)};document.addEventListener(n,e,{passive:!0}),t.S.push(function(){return document.removeEventListener(n,e)})});var n=function(t){return i(t,"submit")};document.addEventListener("submit",n,{passive:!0}),this.S.push(function(){return document.removeEventListener("submit",n)})},t.prototype.C=function(){var t=this,i=h(function(i){if(t.i&&t.t&&!(t.l>=t._.maxMouseEvents)){var n=i.target,e={x:i.clientX,y:i.clientY,type:"move",element:n?t.R(n):"document",timestamp:a()};t.G("mouse_move",e),t.l++,t.k++,t.H()}},this._.mouseSampleRate);document.addEventListener("mousemove",i,{passive:!0}),this.S.push(function(){return document.removeEventListener("mousemove",i)})},t.prototype.D=function(){var t=this;"IntersectionObserver"in window&&(this.q=new IntersectionObserver(function(i){i.forEach(function(i){var n,e=i.target,r=i.isIntersecting,s=a();if(r)t.I.set(e,s);else{var o=t.I.get(e);if(o){var u=s-o,c={element:t.R(e),visible:!1,duration:u,timestamp:s};t.G("element_visibility",c),t.I.delete(e),null===(n=t.t)||void 0===n||n.config.debug}}})},{threshold:[0,.25,.5,.75,1]}),document.querySelectorAll("[data-track-visibility], .cta, .product, .pricing").forEach(function(i){var n;null===(n=t.q)||void 0===n||n.observe(i),t.T.add(i)}))},t.prototype.N=function(){var t,i=this;if("PerformanceObserver"in window)try{this.L=new PerformanceObserver(function(t){t.getEntries().forEach(function(t){"largest-contentful-paint"===t.entryType?i.G("performance",{metric:"lcp",value:t.startTime,timestamp:a()}):"first-input"===t.entryType?i.G("performance",{metric:"fid",value:t.processingStart-t.startTime,timestamp:a()}):"layout-shift"===t.entryType&&i.G("performance",{metric:"cls",value:t.value,timestamp:a()})})}),this.L.observe({entryTypes:["largest-contentful-paint","first-input","layout-shift"]})}catch(i){null===(t=this.t)||void 0===t||t.config.debug}},t.prototype.J=function(){var t=this,i=function(){t.B&&clearTimeout(t.B),t.B=window.setTimeout(function(){t.G("user_idle",{duration:3e4,timestamp:a()})},3e4)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(n){document.addEventListener(n,i,{passive:!0}),t.S.push(function(){return document.removeEventListener(n,i)})}),i()},t.prototype.A=function(){var t=this;this.K=window.setInterval(function(){if(t.i&&t.t){var i=t.W();t.G("engagement_metrics",i),t.t.config.debug}},3e4)},t.prototype.W=function(){var t=a(),i=t-this.o,n=t-this.u,e=25*Math.min(this.v/100,1),r=25*Math.min(this.m/5,1),s=25*Math.min(this.p/3,1),o=25*Math.min(i/6e4,1),u=Math.round(e+r+s+o);return{timeOnPage:i,scrollDepth:this.v,clickCount:this.m,formInteractions:this.p,mouseMovements:this.k,idleTime:n,engagementScore:u}},t.prototype.G=function(t,i){if(this.t){var n={type:t,element:i.element||t,value:i.value||JSON.stringify(i),timestamp:i.timestamp||a(),sessionId:this.t.session.sessionId,visitorId:this.t.session.visitorId,metadata:i};this.t.track("behavioral:".concat(t),n)}},t.prototype.H=function(){this.u=a()},t.prototype.F=function(t){return this._.excludeSelectors.some(function(i){return t.matches(i)})},t.prototype.R=function(t){if(!t)return"unknown";if(t.id)return"#".concat(t.id);if(t.className&&"string"==typeof t.className){var i=t.className.split(" ").filter(function(t){return t.length>0});if(i.length>0)return".".concat(i[0])}return t.tagName?t.tagName.toLowerCase():"unknown"},t.prototype.U=function(t){return(t.textContent||t.value||"").trim().slice(0,100)},t.prototype.enable=function(){this.i=!0},t.prototype.disable=function(){this.i=!1},t.prototype.destroy=function(){var t;this.i=!1,this.B&&clearTimeout(this.B),this.K&&clearInterval(this.K),this.q&&this.q.disconnect(),this.L&&this.L.disconnect(),this.S.forEach(function(t){return t()}),this.S=[],this.T.clear(),this.I.clear(),null===(t=this.t)||void 0===t||t.config.debug},t.prototype.getEngagementMetrics=function(){return this.W()},t.prototype.trackCustomEvent=function(t,i){this.G(t,i)},t}(),S=function(){function t(){this.X=new Map}return t.prototype.on=function(t,i){this.X.has(t)||this.X.set(t,[]),this.X.get(t).push(i)},t.prototype.off=function(t,i){var n=this.X.get(t);if(n){var e=n.indexOf(i);e>-1&&n.splice(e,1),0===n.length&&this.X.delete(t)}},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var e=this.X.get(t);e&&s([],e,!0).forEach(function(t){try{t.apply(void 0,i)}catch(t){process.env.NODE_ENV}})},t.prototype.once=function(t,i){var n=this,e=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];i.apply(void 0,r),n.off(t,e)};this.on(t,e)},t.prototype.removeAllListeners=function(t){t?this.X.delete(t):this.X.clear()},t.prototype.listenerCount=function(t){var i=this.X.get(t);return i?i.length:0},t.prototype.eventNames=function(){return Array.from(this.X.keys())},t}(),M=function(){function t(t,i){void 0===i&&(i={}),this.Y=null,this.Z=null,this.S=new Map,this.$=!1,this.SESSION_KEY="session",this.VISITOR_KEY="visitor",this.FINGERPRINT_KEY="fingerprint",this.TABS_KEY="active_tabs",this.HEARTBEAT_KEY="heartbeat",this.tt=t,this.it=n({sessionTimeout:18e5,enableCrossTabs:!0,enableFingerprinting:!0,fingerprintElements:{screen:!0,timezone:!0,language:!0,platform:!0,plugins:!0,canvas:!1},sessionValidation:!0,storagePrefix:"opt_session_"},i),this.nt=this.et(),this.it.enableFingerprinting&&this.rt(),this.it.enableCrossTabs&&f()&&(this.st(),this.ot())}return t.prototype.initializeSession=function(){return e(this,void 0,void 0,function(){var t,i,n;return r(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.ut()];case 1:return(t=e.sent())?(this.Y=t,this.ct("session:restored",t),[2,t]):[4,this.ht()];case 2:return i=e.sent(),this.Y=i,this.ft(i),this.ct("session:created",i),[2,i];case 3:return e.sent(),n=this.lt(),this.Y=n,[2,n];case 4:return[2]}})})},t.prototype.getCurrentSession=function(){return this.Y},t.prototype.updateActivity=function(){this.Y&&(this.Y.lastActivity=a(),this.Y.pageViews++,this.ft(this.Y))},t.prototype.validateSession=function(){return e(this,void 0,void 0,function(){var t,i,n,e;return r(this,function(r){switch(r.label){case 0:return this.Y?(t=[],i=!0,a()-this.Y.lastActivity>this.it.sessionTimeout&&(i=!1,t.push("Session timeout exceeded")),this.it.enableFingerprinting&&this.it.sessionValidation?[4,this.rt()]:[3,2]):[2,{isValid:!1,reasons:["No active session"],fingerprint:this.Z,lastValidated:a()}];case 1:n=r.sent(),(e=this.dt())&&n.hash!==e.hash&&this.vt(n,e)&&(i=!1,t.push("Session fingerprint validation failed")),r.label=2;case 2:return[2,{isValid:i,reasons:t,fingerprint:this.Z,lastValidated:a()}]}})})},t.prototype.invalidateSession=function(){this.Y&&(this.ct("session:invalid",this.Y),this.Y=null,this.tt.remove(this.SESSION_KEY))},t.prototype.getFingerprint=function(){return this.Z},t.prototype.on=function(t,i){this.S.has(t)||this.S.set(t,[]),this.S.get(t).push(i)},t.prototype.off=function(t,i){var n=this.S.get(t);if(n){var e=n.indexOf(i);e>-1&&n.splice(e,1)}},t.prototype.destroy=function(){if(!this.$){this.wt&&clearInterval(this.wt),this.gt&&clearInterval(this.gt);try{this.yt()}catch(t){}this.S.clear(),this.$=!0}},t.prototype.ut=function(){return e(this,void 0,void 0,function(){var t,i;return r(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),(t=this.tt.get(this.SESSION_KEY))&&(i=l(t,null))?[4,this.bt(i)]:[2,null];case 1:return n.sent().isValid?[2,i]:(this.tt.remove(this.SESSION_KEY),[2,null]);case 2:return n.sent(),[2,null];case 3:return[2]}})})},t.prototype.ht=function(){return e(this,void 0,void 0,function(){var t,i;return r(this,function(n){try{t=this.tt.get(this.VISITOR_KEY)||o(),this.tt.set(this.VISITOR_KEY,t)}catch(i){t=o()}i={sessionId:u(),visitorId:t,startTime:a(),lastActivity:a(),pageViews:0,platform:g(),userAgent:w(),referrer:p(),landingPage:v()};try{this.kt()}catch(t){}return[2,i]})})},t.prototype.lt=function(){return{sessionId:u(),visitorId:o(),startTime:a(),lastActivity:a(),pageViews:0,platform:g(),userAgent:w(),referrer:p(),landingPage:v()}},t.prototype.ft=function(t){try{this.tt.set(this.SESSION_KEY,d(t))}catch(t){this.it.debug}},t.prototype.rt=function(){return e(this,void 0,void 0,function(){var t,i,n,e;return r(this,function(r){switch(r.label){case 0:return f()?(t=this.it.fingerprintElements,i={},t.screen&&(i.screenResolution="".concat(screen.width,"x").concat(screen.height)),t.timezone&&(i.timezone=(new Date).getTimezoneOffset()),t.language&&(i.language=navigator.language||"unknown"),t.platform&&(i.platform=g(),i.browser=y()),t.plugins&&(i.pluginsHash=this.Tt()),t.canvas?(n=i,[4,this.It()]):[3,2]):(this.Z={screenResolution:"unknown",timezone:0,language:"unknown",platform:"server",browser:"unknown",pluginsHash:"unknown",hash:"server-side"},[2,this.Z]);case 1:n.canvasHash=r.sent(),r.label=2;case 2:return e=Object.values(i).join("|"),i.hash=this.St(e).toString(),this.Z=i,this.tt.set(this.FINGERPRINT_KEY,d(this.Z)),[2,this.Z]}})})},t.prototype.dt=function(){var t=this.tt.get(this.FINGERPRINT_KEY);return t?l(t,null):null},t.prototype.vt=function(t,i){return t.platform!==i.platform||t.browser!==i.browser||t.screenResolution!==i.screenResolution},t.prototype.bt=function(t){return e(this,void 0,void 0,function(){var i,n,e;return r(this,function(r){return i=a()-t.lastActivity,n=[],e=!0,i>this.it.sessionTimeout&&(e=!1,n.push("Session expired")),[2,{isValid:e,reasons:n,fingerprint:this.Z,lastValidated:a()}]})})},t.prototype.st=function(){var t=this;f()&&(window.addEventListener("storage",function(i){i.key===t.Mt(t.SESSION_KEY)&&t.xt(i.newValue)}),this.wt=window.setInterval(function(){t._t()},5e3))},t.prototype.ot=function(){var t=this;f()&&(this.gt=window.setInterval(function(){t.Ot(),t.At()},1e4))},t.prototype.xt=function(t){var i;if(t){var n=l(t,null);n&&n.sessionId!==(null===(i=this.Y)||void 0===i?void 0:i.sessionId)&&(this.Y=n,this.ct("session:synchronized",n))}},t.prototype._t=function(){var t=this.Vt(),i=a(),n=t[this.nt];(!n||i-n.lastHeartbeat>3e4)&&this.kt()},t.prototype.Ot=function(){var t,i={tabId:this.nt,timestamp:a(),sessionId:(null===(t=this.Y)||void 0===t?void 0:t.sessionId)||"unknown"};this.tt.set(this.HEARTBEAT_KEY,d(i))},t.prototype.Vt=function(){try{var t=this.tt.get(this.TABS_KEY);return t?l(t,{}):{}}catch(t){return{}}},t.prototype.kt=function(){var t;try{var i=this.Vt();i[this.nt]={startTime:a(),lastHeartbeat:a(),sessionId:(null===(t=this.Y)||void 0===t?void 0:t.sessionId)||"pending"},this.tt.set(this.TABS_KEY,d(i))}catch(t){}},t.prototype.yt=function(){try{var t=this.Vt();delete t[this.nt],this.tt.set(this.TABS_KEY,d(t))}catch(t){}},t.prototype.At=function(){for(var t=this.Vt(),i=a(),n=!1,e=0,r=Object.entries(t);e<r.length;e++){var s=r[e],o=s[0];i-s[1].lastHeartbeat>6e4&&(delete t[o],n=!0)}n&&this.tt.set(this.TABS_KEY,d(t))},t.prototype.et=function(){return"tab_"+Math.random().toString(36).substr(2,9)+"_"+a()},t.prototype.Mt=function(t){return this.it.storagePrefix+t},t.prototype.Tt=function(){if(!f()||!navigator.plugins)return"unknown";var t=Array.from(navigator.plugins).map(function(t){return t.name}).sort().join("|");return this.St(t).toString()},t.prototype.It=function(){return e(this,void 0,void 0,function(){var t,i;return r(this,function(n){if(!f())return[2,"unknown"];try{return t=document.createElement("canvas"),(i=t.getContext("2d"))?(i.textBaseline="top",i.font="14px Arial",i.fillText("Fingerprint test 🎨",2,2),[2,this.St(t.toDataURL()).toString()]):[2,"unknown"]}catch(t){return[2,"canvas-blocked"]}return[2]})})},t.prototype.St=function(t){for(var i=0,n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i&=i;return Math.abs(i)},t.prototype.ct=function(t,i){var n={type:t,session:i,timestamp:a(),tabId:this.nt};(this.S.get(t)||[]).forEach(function(t){try{t(n)}catch(t){}})},t}(),x=function(){function t(t){void 0===t&&(t="opt_"),this.jt=new Map,this.Pt=t}return t.prototype.get=function(t){var i=this.Pt+t;try{if(f()&&window.localStorage&&null!==(n=localStorage.getItem(i))){if((e=l(n,null))&&this.Ct(e.expiry))return e.value;e&&localStorage.removeItem(i)}}catch(t){}try{var n,e;if(f()&&window.sessionStorage&&null!==(n=sessionStorage.getItem(i))&&(e=l(n,null))&&this.Ct(e.expiry))return e.value}catch(t){}try{if(f()){var r=this.Dt(i);if(r)return r}}catch(t){}return this.jt.get(i)||null},t.prototype.set=function(t,i,n){var e=this,r=this.Pt+t,s=d({value:i,expiry:n});try{if(f()&&window.localStorage)return void localStorage.setItem(r,s)}catch(t){}try{if(f()&&window.sessionStorage)return void sessionStorage.setItem(r,s)}catch(t){}try{if(f()&&i.length<4e3)return void this.Nt(r,i,n)}catch(t){}this.jt.set(r,i),this.jt.size>100&&Array.from(this.jt.entries()).slice(0,20).forEach(function(t){var i=t[0];return e.jt.delete(i)})},t.prototype.remove=function(t){var i=this.Pt+t;try{f()&&window.localStorage&&localStorage.removeItem(i)}catch(t){}try{f()&&window.sessionStorage&&sessionStorage.removeItem(i)}catch(t){}try{f()&&this.Et(i)}catch(t){}this.jt.delete(i)},t.prototype.clear=function(){var t=this;this.zt().forEach(function(i){return t.remove(i.replace(t.Pt,""))}),this.jt.clear()},t.prototype.Ct=function(t){return!t||Date.now()<t},t.prototype.zt=function(){var t=this,i=[];try{if(f()&&window.localStorage)for(var n=0;n<localStorage.length;n++)(e=localStorage.key(n))&&e.startsWith(this.Pt)&&i.push(e)}catch(t){}try{if(f()&&window.sessionStorage)for(n=0;n<sessionStorage.length;n++){var e;(e=sessionStorage.key(n))&&e.startsWith(this.Pt)&&i.push(e)}}catch(t){}return this.jt.forEach(function(n,e){e.startsWith(t.Pt)&&i.push(e)}),Array.from(new Set(i))},t.prototype.Dt=function(t){var i;if(!f())return null;var n="; ".concat(document.cookie).split("; ".concat(t,"="));if(2===n.length){var e=null===(i=n.pop())||void 0===i?void 0:i.split(";").shift();return e?decodeURIComponent(e):null}return null},t.prototype.Nt=function(t,i,n){if(f()){var e="".concat(t,"=").concat(encodeURIComponent(i),"; path=/");if(n){var r=new Date(n);e+="; expires=".concat(r.toUTCString())}"https:"===location.protocol&&(e+="; secure"),e+="; samesite=lax",document.cookie=e}},t.prototype.Et=function(t){f()&&(document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))},t}(),_=function(t){function o(){var i=t.call(this)||this;return i.isInitialized=!1,i.Jt=new Map,i.Ft=[],i.$=!1,i.tt=new x,i.Rt=new M(i.tt),i.config={apiUrl:"",projectId:"",debug:!1,enableGDPR:!0,sessionTimeout:18e5,batchSize:10,flushInterval:5e3,platform:"auto"},i.session=i.Ut(),i}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(o,t),o.prototype.init=function(t){return e(this,void 0,void 0,function(){var i,n,e,s=this;return r(this,function(r){switch(r.label){case 0:if(this.isInitialized)return this.config.debug,[2];if(this.config=k(this.config,t),!this.config.apiUrl||!this.config.projectId)throw new Error("apiUrl and projectId are required");return this.tt=new x("opt_".concat(this.config.projectId,"_")),i={sessionTimeout:this.config.sessionTimeout||18e5,enableCrossTabs:!0,enableFingerprinting:!0,sessionValidation:!0,storagePrefix:"opt_".concat(this.config.projectId,"_session_")},this.Rt=new M(this.tt,i),this.Rt.on("session:created",function(t){s.session=t.session,s.emit("session:created",t),s.config.debug}),this.Rt.on("session:restored",function(t){s.session=t.session,s.emit("session:restored",t),s.config.debug}),this.Rt.on("session:synchronized",function(t){s.session=t.session,s.emit("session:synchronized",t),s.config.debug}),this.Rt.on("session:invalid",function(t){s.emit("session:invalid",t),s.config.debug}),n=this,[4,this.Rt.initializeSession()];case 1:return n.session=r.sent(),(e=new I({enableClickTracking:!0,enableScrollTracking:!0,enableFormTracking:!0,enableMouseTracking:!!this.config.debug,enableVisibilityTracking:!0,enablePerformanceTracking:!0})).setTracker(this),this.use(e),this.Gt(),f()&&b(function(){s.pageView()}),this.isInitialized=!0,this.emit("initialized",this.config),this.config.debug,[2]}})})},o.prototype.track=function(t,i){if(void 0===i&&(i={}),this.isInitialized)if(this.hasConsent()){var n={type:"custom",element:t,value:i,timestamp:a(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,metadata:i};this.Ht(n),this.emit("track",n),this.config.debug}else this.config.debug;else this.config.debug},o.prototype.identify=function(t,i){void 0===i&&(i={}),this.isInitialized&&(this.session.visitorId=t,this.track("identify",{visitorId:t,traits:i}),this.emit("identify",{visitorId:t,traits:i}))},o.prototype.pageView=function(t){if(void 0===t&&(t={}),this.isInitialized&&this.hasConsent()){var i=n({url:v(),title:m(),timestamp:a(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,referrer:p()},t);this.Rt.updateActivity(),this.session=this.Rt.getCurrentSession()||this.session,this.Ht({type:"pageview",element:i.url,value:i.title,timestamp:i.timestamp,sessionId:i.sessionId,visitorId:i.visitorId,metadata:i}),this.emit("pageview",i),this.config.debug}},o.prototype.use=function(t){this.Jt.has(t.name)?this.config.debug:(this.Jt.set(t.name,t),this.isInitialized&&t.init(),this.emit("module:added",t))},o.prototype.getModule=function(t){return this.Jt.get(t)||null},o.prototype.setConsent=function(t){this.tt.set("consent",JSON.stringify(t)),this.emit("consent:changed",t),this.config.debug},o.prototype.hasConsent=function(){if(!this.config.enableGDPR)return!0;var t=this.tt.get("consent");if(!t)return!1;try{var i=JSON.parse(t);return i.hasConsent&&i.purposes.analytics}catch(t){return!1}},o.prototype.flush=function(){return e(this,void 0,void 0,function(){var t,i,n;return r(this,function(e){switch(e.label){case 0:if(0===this.Ft.length)return[2];t=s([],this.Ft,!0),this.Ft=[],e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.qt(t)];case 2:return e.sent(),this.emit("events:sent",t),[3,4];case 3:return i=e.sent(),(n=this.Ft).unshift.apply(n,t),this.emit("events:failed",i),this.config.debug,[3,4];case 4:return[2]}})})},o.prototype.destroy=function(){this.$||(this.Lt&&clearInterval(this.Lt),this.flush().catch(function(){}),this.Rt.destroy(),this.Jt.forEach(function(t){t.destroy&&t.destroy()}),this.Jt.clear(),this.removeAllListeners(),this.$=!0,this.isInitialized=!1)},o.prototype.Ut=function(){return{sessionId:"",visitorId:"",startTime:0,lastActivity:0,pageViews:0,platform:"",userAgent:"",landingPage:""}},o.prototype.Ht=function(t){this.Ft.push(t),this.Ft.length>=this.config.batchSize&&this.flush().catch(function(){})},o.prototype.Gt=function(){var t=this;this.Lt&&clearInterval(this.Lt),this.Lt=window.setInterval(function(){t.Ft.length>0&&t.flush().catch(function(){})},this.config.flushInterval)},o.prototype.qt=function(t){return e(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this.config.debug,[4,new Promise(function(t){return setTimeout(t,100)})];case 1:return t.sent(),[2]}})})},o}(S),O=null;function A(t){return e(this,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return O||(O=new _),[4,O.init(t)];case 1:return i.sent(),[2,O]}})})}function V(){return O}function j(t,i){O&&O.track(t,i)}function P(t){O&&O.pageView(t)}function C(t,i){O&&O.identify(t,i)}function D(t){O&&O.setConsent(t)}function N(t){var i=new _;return t&&t.apiUrl&&t.projectId&&i.init(t).catch(function(i){t.debug}),i}if(f()){var E=window;E.optimizelyConfig&&A(E.optimizelyConfig),E.Optimizely={init:A,getTracker:V,track:j,pageView:P,identify:C,setConsent:D,createTracker:N,Tracker:_}}var z={init:A,getTracker:V,track:j,pageView:P,identify:C,setConsent:D,createTracker:N,Tracker:_};t.BehavioralTracker=I,t.EventEmitter=S,t.SessionManager=M,t.Storage=x,t.Tracker=_,t.addEventListener=function(t,i,n,e){return t.addEventListener(i,n,e),function(){return t.removeEventListener(i,n,e)}},t.createTracker=N,t.debounce=function(t,i){var n;return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];clearTimeout(n),n=window.setTimeout(function(){return t.apply(void 0,e)},i)}},t.deepMerge=k,t.default=z,t.detectBrowser=y,t.detectPlatform=g,t.domReady=b,t.generateSessionId=u,t.generateVisitorId=o,t.getCurrentTitle=m,t.getCurrentUrl=v,t.getReferrer=p,t.getScrollDepth=function(){if(!f())return 0;var t=window.pageYOffset||document.documentElement.scrollTop,i=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),n=window.innerHeight||document.documentElement.clientHeight;return i<=n?100:Math.round((t+n)/i*100)},t.getTracker=V,t.getUserAgent=w,t.identify=C,t.init=A,t.isBrowser=f,t.isElementVisible=function(t){if(!f())return!1;var i=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,e=window.innerWidth||document.documentElement.clientWidth;return i.top>=0&&i.left>=0&&i.bottom<=n&&i.right<=e},t.isProduction=function(){return"production"===process.env.NODE_ENV},t.now=a,t.pageView=P,t.safeJsonParse=l,t.safeJsonStringify=d,t.setConsent=D,t.simpleHash=function(t){var i=0;if(0===t.length)return i;for(var n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i&=i;return Math.abs(i)},t.throttle=h,t.track=j,Object.defineProperty(t,"Bt",{value:!0})});
//# sourceMappingURL=tracker.min.js.map
