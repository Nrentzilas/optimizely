!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).OptimizelyTracker={})}(this,function(t){"use strict";var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},n(t,i)},i=function(){return i=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var e in n=arguments[i])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},i.apply(this,arguments)};function r(t,n,i,r){return new(i||(i=Promise))(function(e,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(t){t(n)})).then(u,s)}c((r=r.apply(t,n||[])).next())})}function e(t,n){var i,r,e,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=s(0),u.throw=s(1),u.return=s(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(c){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(o=0)),o;)try{if(i=1,r&&(e=2&s[0]?r.return:s[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,s[1])).done)return e;switch(r=0,e&&(s=[2&s[0],e.value]),s[0]){case 0:case 1:e=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((e=(e=o.trys).length>0&&e[e.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!e||s[1]>e[0]&&s[1]<e[3])){o.label=s[1];break}if(6===s[0]&&o.label<e[1]){o.label=e[1],e=s;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(s);break}e[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{i=e=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function o(t,n,i){if(i||2===arguments.length)for(var r,e=0,o=n.length;e<o;e++)!r&&e in n||(r||(r=Array.prototype.slice.call(n,0,e)),r[e]=n[e]);return t.concat(r||Array.prototype.slice.call(n))}function u(){return"v_"+c(16)}function s(){return"s_"+c(12)+"_"+Date.now()}function c(t){for(var n="",i=0;i<t;i++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return n}function a(){return Date.now()}function f(){return"undefined"!=typeof window&&"undefined"!=typeof document}function h(t,n){try{return JSON.parse(t)}catch(t){return n}}function d(t){try{return JSON.stringify(t)}catch(t){return"{}"}}function v(){return f()?window.location.href.split("#")[0].split("?")[0]:""}function l(){return f()&&document.title||""}function w(){return f()&&document.referrer||""}function p(){return f()&&navigator.userAgent||""}function y(){if(!f())return"server";var t=p().toLowerCase();return/android/.test(t)?"android":/iphone|ipad|ipod/.test(t)?"ios":/windows/.test(t)?"windows":/mac/.test(t)?"mac":/linux/.test(t)?"linux":"unknown"}function m(t){f()&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}function g(t,n){var r=i({},t);for(var e in n)if(n.hasOwnProperty(e)){var o=n[e],u=r[e];S(o)&&S(u)?r[e]=g(u,o):void 0!==o&&(r[e]=o)}return r}function S(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)}"function"==typeof SuppressedError&&SuppressedError;var I=function(){function t(){this.t=new Map}return t.prototype.on=function(t,n){this.t.has(t)||this.t.set(t,[]),this.t.get(t).push(n)},t.prototype.off=function(t,n){var i=this.t.get(t);if(i){var r=i.indexOf(n);r>-1&&i.splice(r,1),0===i.length&&this.t.delete(t)}},t.prototype.emit=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=this.t.get(t);r&&o([],r,!0).forEach(function(t){try{t.apply(void 0,n)}catch(t){process.env.NODE_ENV}})},t.prototype.once=function(t,n){var i=this,r=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];n.apply(void 0,e),i.off(t,r)};this.on(t,r)},t.prototype.removeAllListeners=function(t){t?this.t.delete(t):this.t.clear()},t.prototype.listenerCount=function(t){var n=this.t.get(t);return n?n.length:0},t.prototype.eventNames=function(){return Array.from(this.t.keys())},t}(),b=function(){function t(t){void 0===t&&(t="opt_"),this.i=new Map,this.o=t}return t.prototype.get=function(t){var n=this.o+t;try{if(f()&&window.localStorage&&null!==(i=localStorage.getItem(n))){if((r=h(i,null))&&this.u(r.expiry))return r.value;r&&localStorage.removeItem(n)}}catch(t){}try{var i,r;if(f()&&window.sessionStorage&&null!==(i=sessionStorage.getItem(n))&&(r=h(i,null))&&this.u(r.expiry))return r.value}catch(t){}try{if(f()){var e=this.h(n);if(e)return e}}catch(t){}return this.i.get(n)||null},t.prototype.set=function(t,n,i){var r=this,e=this.o+t,o=d({value:n,expiry:i});try{if(f()&&window.localStorage)return void localStorage.setItem(e,o)}catch(t){}try{if(f()&&window.sessionStorage)return void sessionStorage.setItem(e,o)}catch(t){}try{if(f()&&n.length<4e3)return void this.v(e,n,i)}catch(t){}this.i.set(e,n),this.i.size>100&&Array.from(this.i.entries()).slice(0,20).forEach(function(t){var n=t[0];return r.i.delete(n)})},t.prototype.remove=function(t){var n=this.o+t;try{f()&&window.localStorage&&localStorage.removeItem(n)}catch(t){}try{f()&&window.sessionStorage&&sessionStorage.removeItem(n)}catch(t){}try{f()&&this.l(n)}catch(t){}this.i.delete(n)},t.prototype.clear=function(){var t=this;this.p().forEach(function(n){return t.remove(n.replace(t.o,""))}),this.i.clear()},t.prototype.u=function(t){return!t||Date.now()<t},t.prototype.p=function(){var t=this,n=[];try{if(f()&&window.localStorage)for(var i=0;i<localStorage.length;i++)(r=localStorage.key(i))&&r.startsWith(this.o)&&n.push(r)}catch(t){}try{if(f()&&window.sessionStorage)for(i=0;i<sessionStorage.length;i++){var r;(r=sessionStorage.key(i))&&r.startsWith(this.o)&&n.push(r)}}catch(t){}return this.i.forEach(function(i,r){r.startsWith(t.o)&&n.push(r)}),Array.from(new Set(n))},t.prototype.h=function(t){var n;if(!f())return null;var i="; ".concat(document.cookie).split("; ".concat(t,"="));if(2===i.length){var r=null===(n=i.pop())||void 0===n?void 0:n.split(";").shift();return r?decodeURIComponent(r):null}return null},t.prototype.v=function(t,n,i){if(f()){var r="".concat(t,"=").concat(encodeURIComponent(n),"; path=/");if(i){var e=new Date(i);r+="; expires=".concat(e.toUTCString())}"https:"===location.protocol&&(r+="; secure"),r+="; samesite=lax",document.cookie=r}},t.prototype.l=function(t){f()&&(document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))},t}(),T=function(t){function c(){var n=t.call(this)||this;return n.isInitialized=!1,n.m=new Map,n.S=[],n.I=!1,n.T=new b,n.config={apiUrl:"",projectId:"",debug:!1,enableGDPR:!0,sessionTimeout:18e5,batchSize:10,flushInterval:5e3,platform:"auto"},n.session=n.k(),n}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}(c,t),c.prototype.init=function(t){var n=this;if(this.isInitialized)this.config.debug;else{if(this.config=g(this.config,t),!this.config.apiUrl||!this.config.projectId)throw new Error("apiUrl and projectId are required");this.T=new b("opt_".concat(this.config.projectId,"_")),this.O(),this.j(),f()&&m(function(){n.pageView()}),this.isInitialized=!0,this.emit("initialized",this.config),this.config.debug}},c.prototype.track=function(t,n){if(void 0===n&&(n={}),this.isInitialized)if(this.hasConsent()){var i={type:"custom",element:t,value:n,timestamp:a(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,metadata:n};this.A(i),this.emit("track",i),this.config.debug}else this.config.debug;else this.config.debug},c.prototype.identify=function(t,n){void 0===n&&(n={}),this.isInitialized&&(this.session.visitorId=t,this._(),this.track("identify",{visitorId:t,traits:n}),this.emit("identify",{visitorId:t,traits:n}))},c.prototype.pageView=function(t){if(void 0===t&&(t={}),this.isInitialized&&this.hasConsent()){var n=i({url:v(),title:l(),timestamp:a(),sessionId:this.session.sessionId,visitorId:this.session.visitorId,referrer:w()},t);this.session.pageViews++,this.session.lastActivity=a(),this._(),this.A({type:"pageview",element:n.url,value:n.title,timestamp:n.timestamp,sessionId:n.sessionId,visitorId:n.visitorId,metadata:n}),this.emit("pageview",n),this.config.debug}},c.prototype.use=function(t){this.m.has(t.name)?this.config.debug:(this.m.set(t.name,t),this.isInitialized&&t.init(),this.emit("module:added",t))},c.prototype.getModule=function(t){return this.m.get(t)||null},c.prototype.setConsent=function(t){this.T.set("consent",JSON.stringify(t)),this.emit("consent:changed",t),this.config.debug},c.prototype.hasConsent=function(){if(!this.config.enableGDPR)return!0;var t=this.T.get("consent");if(!t)return!1;try{var n=JSON.parse(t);return n.hasConsent&&n.purposes.analytics}catch(t){return!1}},c.prototype.flush=function(){return r(this,void 0,void 0,function(){var t,n,i;return e(this,function(r){switch(r.label){case 0:if(0===this.S.length)return[2];t=o([],this.S,!0),this.S=[],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.M(t)];case 2:return r.sent(),this.emit("events:sent",t),[3,4];case 3:return n=r.sent(),(i=this.S).unshift.apply(i,t),this.emit("events:failed",n),this.config.debug,[3,4];case 4:return[2]}})})},c.prototype.destroy=function(){this.I||(this.C&&clearInterval(this.C),this.flush().catch(function(){}),this.m.forEach(function(t){t.destroy&&t.destroy()}),this.m.clear(),this.removeAllListeners(),this.I=!0,this.isInitialized=!1)},c.prototype.O=function(){var t=this.T.get("session");if(t)try{var n=JSON.parse(t);if(a()-n.lastActivity<this.config.sessionTimeout)return this.session=n,this.session.lastActivity=a(),void this._()}catch(t){}this.session=this.J(),this._()},c.prototype.J=function(){var t=this.T.get("visitorId")||u();return this.T.set("visitorId",t),{sessionId:s(),visitorId:t,startTime:a(),lastActivity:a(),pageViews:0,platform:"auto"===this.config.platform?y():this.config.platform,userAgent:p(),referrer:w(),landingPage:v()}},c.prototype.k=function(){return{sessionId:"",visitorId:"",startTime:0,lastActivity:0,pageViews:0,platform:"",userAgent:"",landingPage:""}},c.prototype._=function(){this.T.set("session",JSON.stringify(this.session))},c.prototype.A=function(t){this.S.push(t),this.S.length>=this.config.batchSize&&this.flush().catch(function(){})},c.prototype.j=function(){var t=this;this.C&&clearInterval(this.C),this.C=window.setInterval(function(){t.S.length>0&&t.flush().catch(function(){})},this.config.flushInterval)},c.prototype.M=function(t){return r(this,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return this.config.debug,[4,new Promise(function(t){return setTimeout(t,100)})];case 1:return t.sent(),[2]}})})},c}(I),k=null;function O(t){return k||(k=new T),k.init(t),k}function x(){return k}function j(t,n){k&&k.track(t,n)}function A(t){k&&k.pageView(t)}function _(t,n){k&&k.identify(t,n)}function M(t){k&&k.setConsent(t)}function C(){return new T}if(f()){var J=window;J.optimizelyConfig&&O(J.optimizelyConfig),J.Optimizely={init:O,getTracker:x,track:j,pageView:A,identify:_,setConsent:M,createTracker:C,Tracker:T}}var D={init:O,getTracker:x,track:j,pageView:A,identify:_,setConsent:M,createTracker:C,Tracker:T};t.EventEmitter=I,t.Storage=b,t.Tracker=T,t.addEventListener=function(t,n,i,r){return t.addEventListener(n,i,r),function(){return t.removeEventListener(n,i,r)}},t.createTracker=C,t.debounce=function(t,n){var i;return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];clearTimeout(i),i=window.setTimeout(function(){return t.apply(void 0,r)},n)}},t.deepMerge=g,t.default=D,t.detectBrowser=function(){if(!f())return"unknown";var t=p().toLowerCase();return/chrome/.test(t)&&!/edge/.test(t)?"chrome":/firefox/.test(t)?"firefox":/safari/.test(t)&&!/chrome/.test(t)?"safari":/edge/.test(t)?"edge":/opera/.test(t)?"opera":"unknown"},t.detectPlatform=y,t.domReady=m,t.generateSessionId=s,t.generateVisitorId=u,t.getCurrentTitle=l,t.getCurrentUrl=v,t.getReferrer=w,t.getScrollDepth=function(){if(!f())return 0;var t=window.pageYOffset||document.documentElement.scrollTop,n=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),i=window.innerHeight||document.documentElement.clientHeight;return n<=i?100:Math.round((t+i)/n*100)},t.getTracker=x,t.getUserAgent=p,t.identify=_,t.init=O,t.isBrowser=f,t.isElementVisible=function(t){if(!f())return!1;var n=t.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return n.top>=0&&n.left>=0&&n.bottom<=i&&n.right<=r},t.isProduction=function(){return"production"===process.env.NODE_ENV},t.now=a,t.pageView=A,t.safeJsonParse=h,t.safeJsonStringify=d,t.setConsent=M,t.simpleHash=function(t){var n=0;if(0===t.length)return n;for(var i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i),n&=n;return Math.abs(n)},t.throttle=function(t,n){var i;return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];i||(t.apply(void 0,r),i=!0,setTimeout(function(){return i=!1},n))}},t.track=j,Object.defineProperty(t,"D",{value:!0})});
//# sourceMappingURL=tracker.min.js.map
